# PR Analyzer Agent

An agentic AI system that analyzes GitHub Pull Requests using the Model Context Protocol (MCP) and posts analysis results as comments.

## Features

- **Automated PR Analysis**: Analyzes PRs against predefined rules and standards
- **GitHub MCP Integration**: Uses GitHub's MCP server for native PR data fetching
- **Custom Rules Engine**: Applies your own rules and standards
- **Automated Commenting**: Posts analysis results directly on PRs
- **Code Quality Checks**: Validates code quality, security, documentation, and more
- **GitHub Actions Integration**: Triggered automatically on PR events

## Architecture

```
GitHub PR Created ‚Üí GitHub Actions ‚Üí MCP Server (ours)
                                           ‚Üì
                                    GitHub MCP Client
                                           ‚Üì
                                    Integrated Analyzer
                                    (applies custom rules)
                                           ‚Üì
                                    Posts comment on PR
```

## Components

### Core Files

1. **rules.ts**: Defines PR analysis rules and standards
   - Code quality criteria
   - Testing requirements
   - Commit conventions
   - Documentation standards
   - Security checks
   - Performance metrics

2. **mcp-client.ts**: GitHub MCP Client
   - Connects to GitHub MCP server
   - Fetches PR details, files, commits
   - Posts comments

3. **integrated-analyzer.ts**: Core analysis logic
   - Fetches PR data via MCP
   - Analyzes against custom rules
   - Generates detailed reports

4. **integrated-server.ts**: MCP Server
   - Exposes PR analysis tools
   - Integrates with GitHub MCP

## Setup

### Prerequisites
- Node.js 18+
- GitHub CLI (`gh`) installed
- GitHub token with repo access

### Installation

1. Clone the repository
```bash
git clone https://github.com/ddgk17/Webhook-check.git
cd Webhook-check
```

2. Install dependencies
```bash
npm install
```

3. Create `.env` file
```bash
cp .env.example .env
# Edit .env with your GitHub token
```

4. Build the project
```bash
npm run build
```

5. Start the server
```bash
npm start
```

## Usage

### Manual Analysis
```bash
node -e "
import('./dist/integrated-analyzer.js').then(async (m) => {
  const { IntegratedPRAnalyzer } = m;
  const { GitHubMCPClient } = await import('./dist/mcp-client.js');
  
  const client = new GitHubMCPClient({ command: 'gh', args: ['api', 'graphql'] });
  const analyzer = new IntegratedPRAnalyzer(client);
  
  await client.connect();
  const analysis = await analyzer.fetchAndAnalyzePR('owner', 'repo', 123);
  await analyzer.postAnalysisComment('owner', 'repo', 123, analysis);
  await client.disconnect();
});
"
```

### Automatic via GitHub Actions
The system triggers automatically when a PR is created or updated. It:
1. Fetches PR data
2. Analyzes against rules
3. Posts formatted comment

## Analysis Criteria

### Code Quality
- Max line length: 100 characters
- Function documentation required
- Type annotations required
- No console.log in production
- Max complexity: 10
- Tests required

### Testing
- Min coverage: 80%
- Tests for new features required
- Tests for bug fixes required

### Commits
- Max 20 files per commit
- Conventional commits required
- Min message length: 10 chars
- Max message length: 100 chars

### Documentation
- README updates encouraged
- Changelog entries encouraged
- API documentation required
- Min PR description: 20 chars

### Security
- No hardcoded secrets
- No sensitive data
- Dependency scanning
- API key detection

### Performance
- Max file size increase: 100KB
- Large file warnings
- Bundle size checks

## Score Calculation

PRs receive a score from 0-100:
- Violations deduct 5-15 points each
- Suggestions deduct 2-5 points each
- Maximum score: 100

## Status Codes

- **pass**: No violations found ‚úÖ
- **warning**: Suggestions present but no violations ‚ö†Ô∏è
- **fail**: Violations present ‚ùå

## Analysis Report Example

```
## üîç PR Analysis Report

**Status:** WARNING
**Score:** 85/100

### ‚ùå Violations
- PR description is too short or missing

### ‚ö†Ô∏è Suggestions
- Remove console.log statements in production code (src/app.ts)
- Consider updating README.md for significant changes
- Possible API key or secret in src/config.ts. Ensure it's not hardcoded.

---
*Generated by PR Analyzer Agent*
```

## Configuration

All analysis rules can be customized in `src/rules.ts`:

```typescript
export const PR_ANALYSIS_RULES = {
  codeQuality: { /* ... */ },
  testing: { /* ... */ },
  commits: { /* ... */ },
  documentation: { /* ... */ },
  security: { /* ... */ },
  performance: { /* ... */ },
};
```

## Development

```bash
# Build TypeScript
npm run build

# Run in development mode
npm run dev

# Start server
npm start
```

## Integration with Other Tools

The MCP server can be integrated with other tools and clients that support the Model Context Protocol:

```typescript
import { GitHubMCPClient } from './dist/mcp-client.js';
import { IntegratedPRAnalyzer } from './dist/integrated-analyzer.js';

// Your custom integration
```

## License

MIT

## Contributing

Contributions are welcome! Please ensure:
- Code follows the analysis rules
- Tests pass
- Documentation is updated
- Conventional commits are used

## Support

For issues and questions, please use GitHub issues.
